<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laam Wallet - All-in-One Crypto Solution</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a00e0;
            --primary-light: #8e2de2;
            --secondary: #00c6ff;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #f5f5f5;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #e84393;
            --gray: #636e72;
            --card-bg: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark), var(--darker));
            color: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Auth Styles */
        .auth-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--card-border);
            margin-top: 50px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-header p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 5px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 2px rgba(142, 45, 226, 0.3);
        }

        .btn {
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 45, 226, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 1px solid var(--card-border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #d6307a;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-warning:hover {
            background: #fcad2b;
        }

        /* Additional button styles for new buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .action-buttons .btn {
            flex: 1;
            margin-top: 0;
        }

        /* Settings Button Styles */
        .settings-container {
            position: relative;
            display: inline-block;
        }

        .settings-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--card-border);
            color: var(--light);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .settings-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--darker);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 10px;
            min-width: 200px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            margin-top: 5px;
        }

        .settings-dropdown.active {
            display: block;
        }

        .settings-item {
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Mnemonic styles */
        .mnemonic-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--card-border);
        }

        .mnemonic-words {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .mnemonic-word {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }

        .mnemonic-word .word-index {
            font-size: 0.8rem;
            color: var(--gray);
            margin-right: 5px;
        }

        /* Wallet Styles */
        .wallet-container {
            width: 100%;
            display: none;
        }

        .wallet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            width: 100%;
        }

        .wallet-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .wallet-logo h1 {
            font-size: 2rem;
            background: linear-gradient(to right, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .wallet-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .wallet-actions .btn {
            width: auto;
            padding: 10px 20px;
        }

        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
            width: 100%;
        }

        .wallet-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .wallet-card:hover {
            transform: translateY(-5px);
        }

        .wallet-card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--secondary);
        }

        .wallet-card h2 i {
            font-size: 1.3rem;
        }

        /* NEW: Portfolio Balance Card Styles */
        .balance-card {
            grid-column: span 2;
            background: linear-gradient(135deg, var(--dark), var(--darker));
            border: 1px solid var(--card-border);
        }

        .total-balance {
            text-align: center;
            margin-bottom: 25px;
        }

        .total-balance h3 {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .total-balance .amount {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .action-buttons-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .action-button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-light);
            transform: translateY(-3px);
        }

        .action-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .action-text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* NEW: Assets Grid Styles */
        .assets-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .asset-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid var(--card-border);
            transition: all 0.3s ease;
        }

        .asset-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .asset-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .asset-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            font-size: 1.2rem;
        }

        .asset-icon img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .asset-details {
            display: flex;
            flex-direction: column;
        }

        .asset-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .asset-price {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .per {
            color: var(--gray);
        }

        .price-change {
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .price-change.positive {
            background: rgba(0, 184, 148, 0.2);
            color: var(--success);
        }

        .price-change.negative {
            background: rgba(232, 67, 147, 0.2);
            color: var(--danger);
        }

        .muted {
            color: var(--gray);
            font-size: 0.85rem;
        }

        .asset-right {
            text-align: right;
        }

        .asset-balance {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .asset-balance-sub {
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .status-message {
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: 500;
        }

        .status-success {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .status-error {
            background: rgba(232, 67, 147, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .status-warning {
            background: rgba(253, 203, 110, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .qrcode-container {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .token-list {
            list-style: none;
            margin-top: 15px;
        }

        .token-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--card-border);
        }

        .token-item:last-child {
            border-bottom: none;
        }

        .secret-keys-container {
            margin-top: 20px;
            padding: 15px;
            background: rgba(232, 67, 147, 0.1);
            border-radius: 10px;
            border: 1px solid var(--danger);
        }

        .secret-keys-container h3 {
            color: var(--danger);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .secret-keys-container p {
            margin: 10px 0;
            word-break: break-all;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--darker);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .wallet-grid {
                grid-template-columns: 1fr;
            }
            
            .balance-card {
                grid-column: span 1;
            }
            
            .action-buttons-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .wallet-header {
                flex-direction: column;
                gap: 20px;
            }
            
            .wallet-actions {
                width: 100%;
                justify-content: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .mnemonic-words {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .settings-dropdown {
                right: auto;
                left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Wallet Setup Section -->
        <div class="auth-container" id="auth-container">
            <div class="auth-header">
                <h1>Laam Wallet</h1>
                <p>Your All-in-One Crypto Solution</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="create">Create New Wallet</div>
                <div class="auth-tab" data-tab="import">Import Existing Wallet</div>
            </div>
            
            <div class="auth-form active" id="create-form">
                <div class="form-group">
                    <label for="create-password">Set Password</label>
                    <input type="password" id="create-password" class="form-control" placeholder="Enter a strong password">
                </div>
                
                <div class="form-group">
                    <label for="confirm-password">Confirm Password</label>
                    <input type="password" id="confirm-password" class="form-control" placeholder="Confirm your password">
                </div>
                
                <button class="btn btn-primary" id="create-btn">Create New Wallet</button>
                
                <!-- Mnemonic Display (Hidden Initially) -->
                <div id="mnemonic-display" style="display: none; margin-top: 20px;">
                    <div class="mnemonic-container">
                        <h3 style="text-align: center; margin-bottom: 15px;">
                            <i class="fas fa-key"></i> Your Recovery Phrase
                        </h3>
                        <div class="mnemonic-words" id="mnemonic-words">
                            <!-- Mnemonic words will be inserted here -->
                        </div>
                        <p style="color: var(--warning); text-align: center; margin: 15px 0;">
                            <i class="fas fa-exclamation-triangle"></i> 
                            Write down these 12 words and store them in a safe place. You will need them to restore your wallet.
                        </p>
                    </div>
                    <button class="btn btn-primary" id="confirm-mnemonic">
                        <i class="fas fa-check"></i> I've Saved My Recovery Phrase
                    </button>
                </div>
            </div>
            
            <div class="auth-form" id="import-form">
                <div class="form-group">
                    <label for="import-mnemonic">12-Word Recovery Phrase</label>
                    <textarea id="import-mnemonic" class="form-control" placeholder="Enter your 12-word recovery phrase separated by spaces"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="import-password">Set Password</label>
                    <input type="password" id="import-password" class="form-control" placeholder="Enter a password to encrypt your wallet">
                </div>
                
                <button class="btn btn-primary" id="import-btn">Import Wallet</button>
                
                <!-- New action buttons for unlock mode -->
                <div class="action-buttons" id="unlock-actions" style="display: none; margin-top: 20px;">
                    <button class="btn btn-warning" id="reset-wallet">
                        <i class="fas fa-redo"></i> Reset Wallet
                    </button>
                    <button class="btn btn-secondary" id="import-new-wallet">
                        <i class="fas fa-file-import"></i> Import New Wallet
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Wallet Section -->
        <div class="wallet-container" id="wallet-container">
            <div class="wallet-header">
                <div class="wallet-logo">
                    <i class="fas fa-wallet fa-2x"></i>
                    <h1>Laam Wallet</h1>
                </div>
                <div class="wallet-actions">
                    <div class="settings-container">
                        <button class="settings-btn" id="settings-btn">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                        <div class="settings-dropdown" id="settings-dropdown">
                            <div class="settings-item" id="settings-wallet-keys">
                                <i class="fas fa-key"></i>
                                <span>Wallet Keys & Backup</span>
                            </div>
                            <div class="settings-item" id="settings-add-token">
                                <i class="fas fa-plus-circle"></i>
                                <span>Add Custom Token</span>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="lock-wallet">
                        <i class="fas fa-lock"></i> Lock Wallet
                    </button>
                </div>
            </div>
            
            <div class="wallet-grid">
                <!-- NEW: Portfolio Balance Card -->
                <div class="wallet-card balance-card">
                    <div class="total-balance">
                        <h3>Total Assets</h3>
                        <div class="amount" id="total-assets">$0.00</div>
                    </div>
                    
                    <div class="action-buttons-grid">
                        <div class="action-button" id="btn-send">
                            <div class="action-icon">‚û§</div>
                            <div class="action-text">Send</div>
                        </div>
                        <div class="action-button" id="btn-swap">
                            <div class="action-icon">üîÅ</div>
                            <div class="action-text">Swap</div>
                        </div>
                        <div class="action-button" id="btn-receive">
                            <div class="action-icon">üì•</div>
                            <div class="action-text">Receive</div>
                        </div>
                        <div class="action-button" id="btn-lock">
                            <div class="action-icon">üîí</div>
                            <div class="action-text">Lock</div>
                        </div>
                    </div>
                    
                    <!-- Assets Grid -->
                    <div class="assets-grid">
                        <!-- XLM Asset -->
                        <div class="asset-item">
                            <div class="asset-left">
                                <div class="asset-icon">
                                    <img src="https://cryptologos.cc/logos/stellar-xlm-logo.png" alt="XLM">
                                </div>
                                <div class="asset-details">
                                    <div class="asset-name">XLM</div>
                                    <div class="asset-price">
                                        <small class="per">$<span id="xlm-price">0.409</span></small>
                                        <span class="price-change positive">+2.5%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="asset-right">
                                <div class="asset-balance"><span id="xlm-balance">0</span> XLM</div>
                                <div class="asset-balance-sub">‚âà $<span id="xlm-balance-usd">0</span></div>
                            </div>
                        </div>
                        
                        <!-- Laam Asset -->
                        <div class="asset-item">
                            <div class="asset-left">
                                <div class="asset-icon">
                                    <img src="https://via.placeholder.com/40/8e2de2/ffffff?text=L" alt="Laam">
                                </div>
                                <div class="asset-details">
                                    <div class="asset-name">Laam</div>
                                    <div class="asset-price">
                                        <small class="per">$<span id="laam-price">0.056</span></small>
                                        <span class="price-change negative">-1.2%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="asset-right">
                                <div class="asset-balance"><span id="laam-balance">0</span> Laam</div>
                                <div class="asset-balance-sub">‚âà $<span id="laam-balance-usd">0</span></div>
                            </div>
                        </div>
                        
                        <!-- USDC Asset -->
                        <div class="asset-item">
                            <div class="asset-left">
                                <div class="asset-icon">
                                    <img src="https://cryptologos.cc/logos/usd-coin-usdc-logo.png" alt="USDC">
                                </div>
                                <div class="asset-details">
                                    <div class="asset-name">USDC</div>
                                    <div class="asset-price">
                                        <small class="per">$<span id="usdc-price">1.00</span></small>
                                        <span class="price-change">0.00%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="asset-right">
                                <div class="asset-balance"><span id="usdc-balance">0</span> USDC</div>
                                <div class="asset-balance-sub">‚âà $<span id="usdc-balance-usd">0</span></div>
                            </div>
                        </div>
                        
                        <!-- BNB Asset -->
                        <div class="asset-item">
                            <div class="asset-left">
                                <div class="asset-icon">
                                    <img src="https://cryptologos.cc/logos/bnb-bnb-logo.png" alt="BNB">
                                </div>
                                <div class="asset-details">
                                    <div class="asset-name">BNB</div>
                                    <div class="asset-price muted">Binance Smart Chain</div>
                                </div>
                            </div>
                            <div class="asset-right">
                                <div class="asset-balance"><span id="bnb-balance">0.0000</span></div>
                                <div class="asset-balance-sub">BNB</div>
                            </div>
                        </div>
                        
                        <!-- USDT Asset -->
                        <div class="asset-item">
                            <div class="asset-left">
                                <div class="asset-icon">
                                    <img src="https://cryptologos.cc/logos/tether-usdt-logo.png" alt="USDT">
                                </div>
                                <div class="asset-details">
                                    <div class="asset-name">USDT (BEP20)</div>
                                    <div class="asset-price muted">Binance Smart Chain</div>
                                </div>
                            </div>
                            <div class="asset-right">
                                <div class="asset-balance"><span id="usdt-balance">0.0000</span></div>
                                <div class="asset-balance-sub">USDT</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- REMOVED: Send Crypto Card -->
            </div>
        </div>
    </div>

    <!-- Wizard Overlay -->
    <div id="wizardOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;"></div>

    <!-- Send Wizard Modal -->
    <div id="sendWizard" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:var(--darker); padding:20px; border-radius:12px; z-index:1000; width:320px; max-width:90%; color:var(--light); border: 1px solid var(--card-border);">
        <h3 style="text-align: center; margin-bottom: 20px; color: var(--secondary);">Send Crypto</h3>

        <!-- Error Box -->
        <div id="wizardError" style="display:none; color:var(--danger); font-weight:600; margin-bottom:10px; text-align:center;">
            Please fill in all required fields
        </div>

        <!-- Step 1: Choose Asset -->
        <div id="step1" class="wizard-step">
            <label for="sendAsset">Asset <span style="color:red">*</span></label>
            <select id="sendAsset" style="width:100%; margin-bottom:10px; padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
                <option value="">--Choose--</option>
                <option value="XLM">XLM</option>
                <option value="LAAM">LAAM</option>
                <option value="USDC">USDC</option>
            </select>
            <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="nextStep(2)" style="flex:1; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">Next</button>
            </div>
        </div>

        <!-- Step 2: Enter Amount -->
        <div id="step2" class="wizard-step" style="display:none;">
            <label for="sendAmount">Amount <span style="color:red">*</span></label>
            <input type="number" id="sendAmount" placeholder="0.0" style="width:100%; margin-bottom:10px; padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
            <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="nextStep(3)" style="flex:1; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">Next</button>
            </div>
        </div>

        <!-- Step 3: Enter Address -->
        <div id="step3" class="wizard-step" style="display:none;">
            <label for="sendDest">Destination Address <span style="color:red">*</span></label>
            <input type="text" id="sendDest" placeholder="Enter Stellar address" style="width:100%; margin-bottom:10px; padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
            
            <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
                <button type="button" onclick="showStep(2)" style="flex:1; background: var(--gray); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer;">Back</button>
                <button type="button" onclick="nextStep(4)" style="flex:1; background: var(--primary); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer;">Next</button>
            </div>
        </div>

        <!-- Step 4: Memo (Optional) -->
        <div id="step4" class="wizard-step" style="display:none;">
            <label for="sendMemo">Memo (Optional)</label>
            <input type="text" id="sendMemo" placeholder="Memo text" style="width:100%; margin-bottom:10px; padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
            <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="nextStep(5)" style="flex:1; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">Next</button>
            </div>
        </div>

        <!-- Step 5: Confirm -->
        <div id="step5" class="wizard-step" style="display:none;">
            <h4 style="text-align: center; margin-bottom: 15px;">Confirm Transaction</h4>
            <p>Asset: <span id="confirmAsset"></span></p>
            <p>Amount: <span id="confirmAmount"></span></p>
            <p>Destination: <span id="confirmDest" style="display:inline-block; word-break:break-all; max-width:100%;"></span></p>
            <p>Memo: <span id="confirmMemo"></span></p>
            <div class="btn-group" style="display:flex; gap:10px; margin-top:20px;">
                <button id="confirmSendBtn" onclick="sendTransaction()" style="flex:1; padding: 10px; background: var(--success); color: white; border: none; border-radius: 8px; cursor: pointer;">Send Now</button>
            </div>
        </div>

        <!-- Step 6: Receipt -->
        <div id="step6" class="wizard-step" style="display:none; text-align:left;">
            <div style="background:var(--card-bg); padding:20px; border-radius:16px; color:var(--light); border: 1px solid var(--card-border);">
                <div style="display:flex; flex-direction:column; align-items:center; gap:8px; margin-bottom:15px; color:var(--light);">
                    <h4 style="margin:0; font-size:1rem; color: var(--success);">Transaction Sent Successfully</h4>
                </div>

                <p style="margin:8px 0; word-break:break-word;">
                    <strong>Destination:</strong> <span id="receiptDest"></span>
                </p>

                <p style="margin:8px 0; word-break:break-all;">
                    <strong>Txid / Hash:</strong> 
                    <a id="receiptHash" href="#" target="_blank" style="color:var(--secondary); text-decoration:underline;"></a>
                </p>

                <p style="margin:8px 0;"><strong>Amount:</strong> <span id="receiptAmount"></span></p>
                <p style="margin:8px 0;"><strong>Date:</strong> <span id="receiptDate"></span></p>

                <div style="text-align:center; margin-top:20px;">
                    <button onclick="closeWizard()" style="padding:10px 20px; font-size:14px; border:none; border-radius:12px; background:var(--success); color:white; font-weight:600; cursor:pointer;">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Receive Modal -->
    <div id="receiveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-qrcode"></i> Receive Crypto</h2>
                <button class="close-modal" id="close-receive">&times;</button>
            </div>
            
            <div class="qrcode-container">
                <div id="receive-qrcode"></div>
                <p style="margin-top: 10px;">Scan to receive funds</p>
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <p><strong>Your Stellar Address:</strong></p>
                <p id="receive-address" style="word-break: break-all; margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;"></p>
                <button class="btn btn-primary" id="copy-address">
                    <i class="fas fa-copy"></i> Copy Address
                </button>
            </div>
        </div>
    </div>

    <!-- Swap Modal -->
    <div id="swapModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-exchange-alt"></i> Swap Crypto</h2>
                <button class="close-modal" id="close-swap">&times;</button>
            </div>
            
            <div style="margin-top: 20px;">
                <div class="field">
                    <label>You sell</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="number" id="swap-give-amount" placeholder="0.0" style="flex: 1; padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
                        <select id="swap-give-asset" style="padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
                            <option value="XLM">XLM</option>
                            <option value="LAAM">LAAM</option>
                            <option value="USDC">USDC</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: 15px 0;">
                    <button id="swap-direction-btn" style="background: var(--primary); color: white; width: 40px; height: 40px; border-radius: 50%; border: none; font-size: 20px; cursor: pointer;">
                        ‚áÖ
                    </button>
                </div>

                <div class="field">
                    <label>You receive</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <input type="number" id="swap-get-amount" placeholder="0.0" readonly style="flex: 1; padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
                        <select id="swap-get-asset" style="padding: 10px; border-radius: 8px; background: var(--card-bg); color: var(--light); border: 1px solid var(--card-border);">
                            <option value="USDC">USDC</option>
                            <option value="XLM">XLM</option>
                            <option value="LAAM">LAAM</option>
                        </select>
                    </div>
                </div>

                <button class="btn btn-primary" id="confirm-swap" style="width: 100%;">
                    <i class="fas fa-exchange-alt"></i> Swap Now
                </button>
            </div>
        </div>
    </div>

    
    <!-- Wallet Keys & Backup Modal -->
    <div class="modal" id="wallet-keys-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> Wallet Keys & Backup</h2>
                <button class="close-modal" id="close-wallet-keys">&times;</button>
            </div>
            
            <div style="margin-top: 20px;">
                <p><strong>Stellar Public Key:</strong> <span id="stellar-public"></span></p>
                <p style="margin-top: 10px;"><strong>BSC Address:</strong> <span id="bsc-address"></span></p>
            </div>
            
            <div class="qrcode-container">
                <div id="qrcode"></div>
                <p style="margin-top: 10px;">Scan to receive XLM</p>
            </div>
            
            <!-- Recovery Phrase Section (Hidden by Default) -->
            <div class="secret-keys-container" id="recovery-phrase-container" style="display: none;">
                <h3><i class="fas fa-exclamation-triangle"></i> Recovery Phrase (Keep Private!)</h3>
                <div class="mnemonic-words" id="recovery-phrase-words">
                    <!-- Recovery phrase words will be inserted here -->
                </div>
                <button class="btn btn-danger" id="hide-recovery-phrase">
                    <i class="fas fa-eye-slash"></i> Hide Recovery Phrase
                </button>
            </div>
            
            <button class="btn btn-secondary" id="show-recovery-phrase" style="margin-top: 15px;">
                <i class="fas fa-eye"></i> Show Recovery Phrase
            </button>
        </div>
    </div>

    <!-- Add Custom Token Modal -->
    <div class="modal" id="add-token-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Add Custom Token</h2>
                <button class="close-modal" id="close-add-token">&times;</button>
            </div>
            
            <select id="token-type">
                <option value="BSC">BSC</option>
                <option value="Stellar">Stellar</option>
            </select>
            <input type="text" id="custom-token-name" placeholder="Token Name">
            <input type="text" id="custom-token-address" placeholder="Contract Address (BSC) or CODE,ISSUER (Stellar)">
            <button class="btn btn-primary" id="add-token">Add Token</button>
            <h3 style="margin-top: 20px;">Your Tokens</h3>
            <ul class="token-list" id="custom-tokens-list"></ul>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" style="position:fixed; top:20px; right:20px; z-index:10001;"></div>

    <script src="https://cdn.jsdelivr.net/npm/stellar-sdk@8.2.3/dist/stellar-sdk.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

    <script>
        // ---------- GLOBAL VARIABLES ----------
        let stellarKeypair = null;
        let bscWallet = null;
        let customTokens = [];
        let currentMnemonic = null;
        let currentStep = 1;

        // Configuration
        const stellarServer = new StellarSdk.Server('https://horizon.stellar.org');
        const laamXlmAsset = new StellarSdk.Asset('Laam','GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64');
        const bscProvider = new ethers.JsonRpcProvider('https://bsc-dataseed.binance.org/');
        const laamBscContractAddress = "YOUR_BSC_LAAM_CONTRACT_ADDRESS";
        const laamBscAbi = ["function balanceOf(address owner) view returns (uint256)","function transfer(address to, uint amount) returns (bool)"];

        // ---------- MODAL FUNCTIONALITY ----------
        const settingsBtn = document.getElementById('settings-btn');
        const settingsDropdown = document.getElementById('settings-dropdown');
        const settingsAddToken = document.getElementById('settings-add-token');
        const settingsWalletKeys = document.getElementById('settings-wallet-keys');
        
        // Modal elements
        const walletKeysModal = document.getElementById('wallet-keys-modal');
        const addTokenModal = document.getElementById('add-token-modal');
        const receiveModal = document.getElementById('receive-modal');
        const swapModal = document.getElementById('swap-modal');
        const closeWalletKeys = document.getElementById('close-wallet-keys');
        const closeAddToken = document.getElementById('close-add-token');
        const closeReceive = document.getElementById('close-receive');
        const closeSwap = document.getElementById('close-swap');

        // Toggle settings dropdown
        settingsBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            settingsDropdown.classList.toggle('active');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            settingsDropdown.classList.remove('active');
        });

        // Prevent dropdown from closing when clicking inside
        settingsDropdown.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // Settings menu items - Open Modals
        settingsWalletKeys.addEventListener('click', () => {
            settingsDropdown.classList.remove('active');
            walletKeysModal.classList.add('active');
        });

        settingsAddToken.addEventListener('click', () => {
            settingsDropdown.classList.remove('active');
            addTokenModal.classList.add('active');
        });

        // Close modals
        closeWalletKeys.addEventListener('click', () => {
            walletKeysModal.classList.remove('active');
        });

        closeAddToken.addEventListener('click', () => {
            addTokenModal.classList.remove('active');
        });

        closeReceive.addEventListener('click', () => {
            receiveModal.classList.remove('active');
        });

        closeSwap.addEventListener('click', () => {
            swapModal.classList.remove('active');
        });

        // Close modals when clicking outside
        walletKeysModal.addEventListener('click', (e) => {
            if (e.target === walletKeysModal) {
                walletKeysModal.classList.remove('active');
            }
        });

        addTokenModal.addEventListener('click', (e) => {
            if (e.target === addTokenModal) {
                addTokenModal.classList.remove('active');
            }
        });

        receiveModal.addEventListener('click', (e) => {
            if (e.target === receiveModal) {
                receiveModal.classList.remove('active');
            }
        });

        swapModal.addEventListener('click', (e) => {
            if (e.target === swapModal) {
                swapModal.classList.remove('active');
            }
        });
   // ---------- ACTION BUTTONS FUNCTIONALITY ----------
        document.getElementById('btn-send').addEventListener('click', () => {
            if (!stellarKeypair) {
                alert('Please unlock your wallet first');
                return;
            }
            openSendWizard();
        });

        document.getElementById('btn-receive').addEventListener('click', () => {
            if (!stellarKeypair) {
                alert('Please unlock your wallet first');
                return;
            }
            openReceiveModal();
        });

        document.getElementById('btn-swap').addEventListener('click', () => {
            if (!stellarKeypair) {
                alert('Please unlock your wallet first');
                return;
            }
            openSwapModal();
        });

        document.getElementById('btn-lock').addEventListener('click', () => {
            lockWallet();
        });

        // ---------- SEND WIZARD FUNCTIONALITY ----------
        function openSendWizard() {
            document.getElementById('sendWizard').style.display = 'block';
            document.getElementById('wizardOverlay').style.display = 'block';
            showStep(1);
        }

        function showStep(step) {
            for(let i = 1; i <= 6; i++) {
                const s = document.getElementById("step" + i);
                if(s) s.style.display = "none";
            }
            currentStep = step;

            // Update confirmation fields for step 5
            if(step === 5) {
                document.getElementById("confirmAsset").textContent = document.getElementById("sendAsset").value;
                document.getElementById("confirmAmount").textContent = document.getElementById("sendAmount").value;
                document.getElementById("confirmDest").textContent = document.getElementById("sendDest").value;
                document.getElementById("confirmMemo").textContent = document.getElementById("sendMemo").value || "‚Äî";
            }

            document.getElementById("step" + step).style.display = "block";
        }

        function nextStep(step) {
            const errorBox = document.getElementById("wizardError");
            errorBox.style.display = "none";

            if(step === 2) {
                let asset = document.getElementById("sendAsset").value;
                if(!asset) {
                    errorBox.textContent = "Please select an asset";
                    errorBox.style.display = "block";
                    return;
                }
            }

            if(step === 3) {
                let amount = document.getElementById("sendAmount").value;
                if(!amount || parseFloat(amount) <= 0) {
                    errorBox.textContent = "Please enter amount";
                    errorBox.style.display = "block";
                    return;
                }
            }

            if(step === 4) {
                let dest = document.getElementById("sendDest").value.trim();
                if(!dest) {
                    errorBox.textContent = "Please enter destination address";
                    errorBox.style.display = "block";
                    return;
                }
            }

            showStep(step);
        }

        function closeWizard() {
            document.getElementById('sendWizard').style.display = 'none';
            document.getElementById('wizardOverlay').style.display = 'none';
            document.getElementById('wizardError').style.display = 'none';
        }

        // ---------- RECEIVE MODAL FUNCTIONALITY ----------
        function openReceiveModal() {
            if (!stellarKeypair) return;
            
            const publicKey = stellarKeypair.publicKey();
            document.getElementById('receive-address').textContent = publicKey;
            
            // Generate QR code
            document.getElementById('receive-qrcode').innerHTML = '';
            QRCode.toCanvas(document.getElementById('receive-qrcode'), publicKey, {
                width: 150,
                height: 150,
                margin: 1,
                color: {
                    dark: '#FFFFFF',
                    light: '#00000000'
                }
            }, function(err) {
                if (err) console.error(err);
            });
            
            receiveModal.classList.add('active');
        }

        document.getElementById('copy-address').addEventListener('click', () => {
            const address = document.getElementById('receive-address').textContent;
            navigator.clipboard.writeText(address).then(() => {
                showToast('Address copied to clipboard!');
            });
        });

        // ---------- SWAP MODAL FUNCTIONALITY ----------
        function openSwapModal() {
            swapModal.classList.add('active');
        }

        document.getElementById('swap-direction-btn').addEventListener('click', () => {
            const giveAsset = document.getElementById('swap-give-asset').value;
            const getAsset = document.getElementById('swap-get-asset').value;
            
            document.getElementById('swap-give-asset').value = getAsset;
            document.getElementById('swap-get-asset').value = giveAsset;
            
            // Clear amounts
            document.getElementById('swap-give-amount').value = '';
            document.getElementById('swap-get-amount').value = '';
        });

        document.getElementById('swap-give-amount').addEventListener('input', () => {
            // Simple conversion logic - in real app, use actual exchange rates
            const giveAmount = parseFloat(document.getElementById('swap-give-amount').value) || 0;
            const giveAsset = document.getElementById('swap-give-asset').value;
            const getAsset = document.getElementById('swap-get-asset').value;
            
            let getAmount = 0;
            if (giveAsset === 'XLM' && getAsset === 'USDC') {
                getAmount = giveAmount * 0.4; // Example rate
            } else if (giveAsset === 'USDC' && getAsset === 'XLM') {
                getAmount = giveAmount * 2.5; // Example rate
            } else if (giveAsset === 'LAAM' && getAsset === 'USDC') {
                getAmount = giveAmount * 0.056; // Example rate
            } else if (giveAsset === 'USDC' && getAsset === 'LAAM') {
                getAmount = giveAmount / 0.056; // Example rate
            }
            
            document.getElementById('swap-get-amount').value = getAmount.toFixed(6);
        });

        document.getElementById('confirm-swap').addEventListener('click', () => {
            const giveAmount = document.getElementById('swap-give-amount').value;
            const giveAsset = document.getElementById('swap-give-asset').value;
            const getAmount = document.getElementById('swap-get-amount').value;
            const getAsset = document.getElementById('swap-get-asset').value;
            
            if (!giveAmount || parseFloat(giveAmount) <= 0) {
                showToast('Please enter amount to swap');
                return;
            }
            
            // In a real app, this would execute the swap
            showToast(`Swapped ${giveAmount} ${giveAsset} for ${getAmount} ${getAsset}`);
            swapModal.classList.remove('active');
            
            // Refresh balances
            setTimeout(refreshBalances, 2000);
        });

        // ---------- TOAST FUNCTIONALITY ----------
        function showToast(message, duration = 3000) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.background = 'var(--primary)';
            toast.style.color = '#fff';
            toast.style.padding = '12px 20px';
            toast.style.borderRadius = '8px';
            toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
            toast.style.marginBottom = '10px';
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            toast.style.transform = 'translateX(100px)';

            document.getElementById('toastContainer').appendChild(toast);

            requestAnimationFrame(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            });

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100px)';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // ---------- WALLET SETUP SYSTEM (Keep existing functionality) ----------
        // [All the existing wallet setup code remains the same...]
        const authContainer = document.getElementById('auth-container');
        const walletContainer = document.getElementById('wallet-container');
        const createForm = document.getElementById('create-form');
        const importForm = document.getElementById('import-form');
        const authTabs = document.querySelectorAll('.auth-tab');
        const createBtn = document.getElementById('create-btn');
        const importBtn = document.getElementById('import-btn');
        const lockWalletBtn = document.getElementById('lock-wallet');
        const resetWalletBtn = document.getElementById('reset-wallet');
        const importNewWalletBtn = document.getElementById('import-new-wallet');
        const unlockActions = document.getElementById('unlock-actions');
        const mnemonicDisplay = document.getElementById('mnemonic-display');
        const confirmMnemonicBtn = document.getElementById('confirm-mnemonic');
        const mnemonicWords = document.getElementById('mnemonic-words');
        const showRecoveryPhraseBtn = document.getElementById('show-recovery-phrase');
        const hideRecoveryPhraseBtn = document.getElementById('hide-recovery-phrase');
        const recoveryPhraseContainer = document.getElementById('recovery-phrase-container');
        const recoveryPhraseWords = document.getElementById('recovery-phrase-words');

        // Switch between create and import tabs
        authTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                
                authTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                if (tabName === 'create') {
                    createForm.classList.add('active');
                    importForm.classList.remove('active');
                    mnemonicDisplay.style.display = 'none';
                } else {
                    importForm.classList.add('active');
                    createForm.classList.remove('active');
                    
                    // Check if we need to show unlock form
                    setupImportForm();
                }
            });
        });

        // Setup import form based on whether wallet exists
        function setupImportForm() {
            const walletData = localStorage.getItem('laamWallet');
            const mnemonicGroup = document.querySelector('label[for="import-mnemonic"]').parentElement;
            
            if (walletData) {
                // Wallet exists - show unlock form
                mnemonicGroup.style.display = 'none';
                document.querySelector('label[for="import-password"]').textContent = "Enter Password";
                document.getElementById('import-password').placeholder = "Enter your wallet password";
                importBtn.textContent = "Unlock Wallet";
                unlockActions.style.display = 'flex';
            } else {
                // No wallet - show full import form
                mnemonicGroup.style.display = 'block';
                document.querySelector('label[for="import-password"]').textContent = "Set Password";
                document.getElementById('import-password').placeholder = "Enter a password to encrypt your wallet";
                importBtn.textContent = "Import Wallet";
                unlockActions.style.display = 'none';
            }
        }

        // Create new wallet
        createBtn.addEventListener('click', () => {
            const password = document.getElementById('create-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!password) {
                alert('Please enter a password');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            if (password.length < 8) {
                alert('Password should be at least 8 characters long');
                return;
            }
            
            // Generate new mnemonic and display it
            generateNewMnemonic();
        });

        // Confirm mnemonic and create wallet
        confirmMnemonicBtn.addEventListener('click', () => {
            const password = document.getElementById('create-password').value;
            createWalletFromMnemonic(currentMnemonic, password);
        });

        // Import existing wallet or unlock wallet
        importBtn.addEventListener('click', () => {
            const walletData = localStorage.getItem('laamWallet');
            
            if (walletData) {
                // Unlock existing wallet
                unlockWallet();
            } else {
                // Import new wallet
                importNewWallet();
            }
        });

        // Reset wallet function
        resetWalletBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset your wallet? This will delete your current wallet and all its data. This action cannot be undone!')) {
                localStorage.removeItem('laamWallet');
                stellarKeypair = null;
                bscWallet = null;
                currentMnemonic = null;
                alert('Wallet has been reset successfully!');
                setupImportForm();
                
                // Clear form fields
                document.getElementById('import-password').value = '';
            }
        });

        // Import new wallet function (show full form)
        importNewWalletBtn.addEventListener('click', () => {
            // Show the full import form
            const mnemonicGroup = document.querySelector('label[for="import-mnemonic"]').parentElement;
            
            mnemonicGroup.style.display = 'block';
            document.querySelector('label[for="import-password"]').textContent = "Set Password";
            document.getElementById('import-password').placeholder = "Enter a password to encrypt your wallet";
            importBtn.textContent = "Import Wallet";
            unlockActions.style.display = 'none';
            
            // Clear form fields
            document.getElementById('import-mnemonic').value = '';
            document.getElementById('import-password').value = '';
        });

        // Show/Hide Recovery Phrase
        showRecoveryPhraseBtn.addEventListener('click', () => {
            if (!stellarKeypair || !bscWallet) {
                alert('Please unlock your wallet first');
                return;
            }
            
            // Get mnemonic from localStorage and decrypt it
            const password = prompt('Enter your password to view recovery phrase:');
            if (!password) return;
            
            const ciphertext = localStorage.getItem('laamWallet');
            if (!ciphertext) {
                alert('No wallet found');
                return;
            }
            
            try {
                const bytes = CryptoJS.AES.decrypt(ciphertext, password);
                const data = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
                
                if (data.mnemonic) {
                    displayMnemonicWords(data.mnemonic, recoveryPhraseWords);
                    recoveryPhraseContainer.style.display = 'block';
                    showRecoveryPhraseBtn.style.display = 'none';
                } else {
                    alert('Recovery phrase not found in wallet data');
                }
            } catch(e) {
                alert('Wrong password or corrupted wallet data');
            }
        });

        hideRecoveryPhraseBtn.addEventListener('click', () => {
            recoveryPhraseContainer.style.display = 'none';
            showRecoveryPhraseBtn.style.display = 'block';
        });

        // Generate new mnemonic
        function generateNewMnemonic() {
            try {
                // Generate a random mnemonic (12 words)
                const wallet = ethers.Wallet.createRandom();
                currentMnemonic = wallet.mnemonic.phrase;
                
                // Display the mnemonic to the user
                displayMnemonicWords(currentMnemonic, mnemonicWords);
                mnemonicDisplay.style.display = 'block';
                
                // Scroll to mnemonic display
                mnemonicDisplay.scrollIntoView({ behavior: 'smooth' });
            } catch(e) {
                alert('Error generating mnemonic: ' + e.message);
                console.error(e);
            }
        }

        // Display mnemonic words in a grid
        function displayMnemonicWords(mnemonic, container) {
            const words = mnemonic.split(' ');
            container.innerHTML = '';
            
            words.forEach((word, index) => {
                const wordElement = document.createElement('div');
                wordElement.className = 'mnemonic-word';
                wordElement.innerHTML = `<span class="word-index">${index + 1}.</span> ${word}`;
                container.appendChild(wordElement);
            });
        }

        // Create wallet from mnemonic
        function createWalletFromMnemonic(mnemonic, password) {
            try {
                // Validate mnemonic using ethers v6 method
                if (!ethers.Mnemonic.isValidMnemonic(mnemonic)) {
                    alert('Invalid mnemonic phrase');
                    return;
                }
                
                // Create BSC wallet from mnemonic
                const bscWallet = ethers.Wallet.fromPhrase(mnemonic);
                
                // Create Stellar keypair from mnemonic
                // For Stellar, we'll use the first 32 bytes of the mnemonic's entropy as the seed
                const seed = CryptoJS.PBKDF2(mnemonic, 'stellar-salt', {
                    keySize: 32 / 4, // 32 bytes
                    iterations: 1000
                });
                
                const seedBytes = CryptoJS.enc.Hex.parse(seed.toString(CryptoJS.enc.Hex));
                const seedArray = new Uint8Array(seedBytes.words.length * 4);
                
                for (let i = 0; i < seedBytes.words.length; i++) {
                    seedArray[i * 4] = (seedBytes.words[i] >> 24) & 0xff;
                    seedArray[i * 4 + 1] = (seedBytes.words[i] >> 16) & 0xff;
                    seedArray[i * 4 + 2] = (seedBytes.words[i] >> 8) & 0xff;
                    seedArray[i * 4 + 3] = seedBytes.words[i] & 0xff;
                }
                
                const stellarKeypair = StellarSdk.Keypair.fromRawEd25519Seed(seedArray.slice(0, 32));
                
                // Save wallet to localStorage
                const data = JSON.stringify({
                    mnemonic: mnemonic,
                    stellarSecret: stellarKeypair.secret(), 
                    bscPrivateKey: bscWallet.privateKey
                });
                
                localStorage.setItem('laamWallet', CryptoJS.AES.encrypt(data, password).toString());
                
                 // Set wallet in memory
                window.stellarKeypair = stellarKeypair;
                window.bscWallet = bscWallet;
                window.currentMnemonic = mnemonic;
                
                // Display public keys in modal
                document.getElementById('stellar-public').textContent = stellarKeypair.publicKey();
                document.getElementById('bsc-address').textContent = bscWallet.address;
                
                // Generate QR code for Stellar public key
                generateQRCode(stellarKeypair.publicKey());
                
                alert('Wallet created successfully!');
                showWallet();
            } catch(e) {
                alert('Error creating wallet: ' + e.message);
                console.error(e);
            }
        }

        // Import new wallet function
        function importNewWallet() {
            const mnemonic = document.getElementById('import-mnemonic').value.trim();
            const password = document.getElementById('import-password').value;
            
            if (!mnemonic || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            if (password.length < 8) {
                alert('Password should be at least 8 characters long');
                return;
            }
            
            createWalletFromMnemonic(mnemonic, password);
        }

        // Unlock wallet function
        function unlockWallet() {
            const password = document.getElementById('import-password').value;
            
            if (!password) {
                alert('Please enter your password');
                return;
            }
            
            const ciphertext = localStorage.getItem('laamWallet');
            if (!ciphertext) {
                alert('No wallet found');
                return;
            }
            
            try {
                const bytes = CryptoJS.AES.decrypt(ciphertext, password);
                const data = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
                
                stellarKeypair = StellarSdk.Keypair.fromSecret(data.stellarSecret);
                bscWallet = new ethers.Wallet(data.bscPrivateKey);
                currentMnemonic = data.mnemonic;
                
                // Display public keys only
                document.getElementById('stellar-public').textContent = stellarKeypair.publicKey();
                document.getElementById('bsc-address').textContent = bscWallet.address;
                
                // Generate QR code for Stellar public key
                generateQRCode(stellarKeypair.publicKey());
                
                alert('Wallet unlocked successfully!');
                showWallet();
            } catch(e) {
                alert('Wrong password or corrupted wallet data');
            }
        }

        // Lock wallet function
        function lockWallet() {
            stellarKeypair = null;
            bscWallet = null;
            currentMnemonic = null;
            showAuth();
        }

        lockWalletBtn.addEventListener('click', lockWallet);

        // Show wallet if user has a wallet
        function checkWalletStatus() {
            const walletData = localStorage.getItem('laamWallet');
            
            if (walletData) {
                // Wallet exists, show unlock form
                showAuth();
                // Switch to import tab for unlocking
                authTabs[1].click();
            } else {
                showAuth();
            }
        }

        function showWallet() {
            authContainer.style.display = 'none';
            walletContainer.style.display = 'block';
            // Refresh balances when wallet is shown
            refreshBalances();
        }

        function showAuth() {
            authContainer.style.display = 'block';
            walletContainer.style.display = 'none';
            // Clear sensitive data from form fields
            document.getElementById('create-password').value = '';
            document.getElementById('confirm-password').value = '';
            document.getElementById('import-mnemonic').value = '';
            document.getElementById('import-password').value = '';
            document.getElementById('stellar-public').textContent = '';
            document.getElementById('bsc-address').textContent = '';
            document.getElementById('qrcode').innerHTML = '';
            mnemonicDisplay.style.display = 'none';
            recoveryPhraseContainer.style.display = 'none';
            showRecoveryPhraseBtn.style.display = 'block';
            
            // Setup import form based on wallet existence
            setupImportForm();
        }

        // Generate QR Code
        function generateQRCode(publicKey) {
            // Clear previous QR code
            document.getElementById('qrcode').innerHTML = '';
            
            QRCode.toCanvas(document.getElementById('qrcode'), publicKey, {
                width: 150,
                height: 150,
                margin: 1,
                color: {
                    dark: '#FFFFFF',
                    light: '#00000000'
                }
            }, function(err) {
                if (err) console.error(err);
            });
        }

        // ---------- WALLET FUNCTIONALITY ----------
        // Balance Functions
        async function getCustomBscTokenBalance(tokenAddress) {
            try {
                const walletConnected = bscWallet.connect(bscProvider);
                const abi = ["function balanceOf(address owner) view returns (uint256)", "function decimals() view returns (uint8)"];
                const contract = new ethers.Contract(tokenAddress, abi, walletConnected);
                const balance = await contract.balanceOf(walletConnected.address);
                const decimals = await contract.decimals();
                return ethers.formatUnits(balance, decimals);
            } catch(e) {
                return '0';
            }
        }

        async function getCustomStellarTokenBalance(assetCode, issuer) {
            try {
                const account = await stellarServer.loadAccount(stellarKeypair.publicKey());
                const bal = account.balances.find(b => b.asset_code === assetCode && b.asset_issuer === issuer)?.balance || '0';
                return bal;
            } catch(e) {
                return '0';
            }
        }

        async function refreshBalances() {
            if (!stellarKeypair || !bscWallet) return;
            
            try {
                const account = await stellarServer.loadAccount(stellarKeypair.publicKey());
                const xlmBalance = account.balances.find(b => b.asset_type === 'native')?.balance || '0';
                const laamXlmBalance = account.balances.find(b => b.asset_code === 'Laam')?.balance || '0';
                
                document.getElementById('xlm-balance').textContent = xlmBalance;
                document.getElementById('laam-balance').textContent = laamXlmBalance;
                
                // Calculate USD values
                const xlmPrice = parseFloat(document.getElementById('xlm-price').textContent);
                const laamPrice = parseFloat(document.getElementById('laam-price').textContent);
                
                document.getElementById('xlm-balance-usd').textContent = (parseFloat(xlmBalance) * xlmPrice).toFixed(2);
                document.getElementById('laam-balance-usd').textContent = (parseFloat(laamXlmBalance) * laamPrice).toFixed(2);
                
                // Update total assets
                updateTotalAssets();
            } catch(e) {
                document.getElementById('xlm-balance').textContent = '0';
                document.getElementById('laam-balance').textContent = '0';
                document.getElementById('xlm-balance-usd').textContent = '0';
                document.getElementById('laam-balance-usd').textContent = '0';
            }
            
            try {
                const walletConnected = bscWallet.connect(bscProvider);
                const bnbBal = await walletConnected.getBalance();
                document.getElementById('bnb-balance').textContent = parseFloat(ethers.formatEther(bnbBal)).toFixed(4);
                
                if (laamBscContractAddress && laamBscContractAddress !== "YOUR_BSC_LAAM_CONTRACT_ADDRESS") {
                    const laamContract = new ethers.Contract(laamBscContractAddress, laamBscAbi, walletConnected);
                    const laamBal = await laamContract.balanceOf(walletConnected.address);
                    document.getElementById('laam-bsc-balance').textContent = ethers.formatUnits(laamBal, 18);
                } else {
                    document.getElementById('laam-bsc-balance').textContent = '0';
                }
            } catch(e) {
                document.getElementById('bnb-balance').textContent = '0.0000';
                document.getElementById('laam-bsc-balance').textContent = '0';
            }
    // Update custom tokens
            const ul = document.getElementById('custom-tokens-list');
            ul.innerHTML = '';
            
            for (let t of customTokens) {
                let balance = '0';
                if (t.type === 'BSC') {
                    balance = await getCustomBscTokenBalance(t.address);
                } else if (t.type === 'Stellar') {
                    const [code, issuer] = t.address.split(',');
                    balance = await getCustomStellarTokenBalance(code.trim(), issuer.trim());
                }
                
                const li = document.createElement('li');
                li.className = 'token-item';
                li.innerHTML = `
                    <span>${t.name}</span>
                    <span>${balance}</span>
                `;
                ul.appendChild(li);
            }
        }

        // Update total assets
        function updateTotalAssets() {
            const xlmUsd = parseFloat(document.getElementById('xlm-balance-usd').textContent) || 0;
            const laamUsd = parseFloat(document.getElementById('laam-balance-usd').textContent) || 0;
            const usdcUsd = parseFloat(document.getElementById('usdc-balance-usd').textContent) || 0;
            
            const total = xlmUsd + laamUsd + usdcUsd;
            document.getElementById('total-assets').textContent = '$' + total.toFixed(2);
        }

        // Send Transaction from Wizard
        async function sendTransaction() {
            const asset = document.getElementById("sendAsset").value;
            const amount = document.getElementById("sendAmount").value;
            const destination = document.getElementById("sendDest").value;
            const memo = document.getElementById("sendMemo").value;

            const btn = document.getElementById("confirmSendBtn");
            btn.textContent = "Sending...";
            btn.disabled = true;

            try {
                const account = await stellarServer.loadAccount(stellarKeypair.publicKey());

                let operation;
                if(asset === "XLM") {
                    operation = StellarSdk.Operation.payment({
                        destination, 
                        asset: StellarSdk.Asset.native(), 
                        amount: amount.toString()
                    });
                } else if(asset === "LAAM") {
                    operation = StellarSdk.Operation.payment({
                        destination, 
                        asset: laamXlmAsset, 
                        amount: amount.toString()
                    });
                } else if(asset === "USDC") {
                    // For USDC, you would need to define the USDC asset
                    const usdcAsset = new StellarSdk.Asset('USDC', 'GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN');
                    operation = StellarSdk.Operation.payment({
                        destination, 
                        asset: usdcAsset, 
                        amount: amount.toString()
                    });
                }

                const txBuilder = new StellarSdk.TransactionBuilder(account, {
                    fee: StellarSdk.BASE_FEE,
                    networkPassphrase: StellarSdk.Networks.PUBLIC
                });

                if(memo) { 
                    txBuilder.addMemo(StellarSdk.Memo.text(memo)); 
                }

                const transaction = txBuilder.addOperation(operation).setTimeout(180).build();
                transaction.sign(stellarKeypair);

                const result = await stellarServer.submitTransaction(transaction);

                // Populate receipt
                document.getElementById("receiptDest").textContent = destination;

                // Txid link to Stellar Expert
                const txLink = `https://stellar.expert/explorer/public/tx/${result.hash}`;
                const receiptHashEl = document.getElementById("receiptHash");
                receiptHashEl.textContent = result.hash.slice(0, 20) + '...';
                receiptHashEl.href = txLink;

                document.getElementById("receiptAmount").textContent = `${amount} ${asset}`;

                const now = new Date();
                const formattedDate = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                document.getElementById("receiptDate").textContent = formattedDate;

                showStep(6);

                // Refresh balances after successful transaction
                setTimeout(refreshBalances, 2000);

            } catch(err) {
                console.error("Send error:", err);
                alert("‚ùå Failed: " + err.message);
            } finally {
                btn.textContent = "Send Now";
                btn.disabled = false;
            }
        }

        // Add Custom Token
        document.getElementById('add-token').addEventListener('click', async () => {
            const name = document.getElementById('custom-token-name').value.trim();
            const address = document.getElementById('custom-token-address').value.trim();
            const type = document.getElementById('token-type').value;
            
            if (!name || !address) return alert('Fill all fields');
            
            let balance = '0';
            if (type === 'BSC') {
                balance = await getCustomBscTokenBalance(address);
            } else if (type === 'Stellar') {
                const [assetCode, issuer] = address.split(',');
                if (!assetCode || !issuer) return alert('Stellar format: CODE,ISSUER');
                balance = await getCustomStellarTokenBalance(assetCode.trim(), issuer.trim());
            }
            
            customTokens.push({name, address, type, balance});
            
            // Update UI
            const ul = document.getElementById('custom-tokens-list');
            const li = document.createElement('li');
            li.className = 'token-item';
            li.innerHTML = `
                <span>${name}</span>
                <span>${balance}</span>
            `;
            ul.appendChild(li);
            
            // Clear form
            document.getElementById('custom-token-name').value = '';
            document.getElementById('custom-token-address').value = '';
        });

        // Initialize the app
        checkWalletStatus();
    </script>
</body>
</html>